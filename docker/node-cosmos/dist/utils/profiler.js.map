{"version":3,"file":"profiler.js","sourceRoot":"","sources":["../../src/utils/profiler.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,sCAAsC;;;AAEtC,qBAAqB;AAErB,qCAAqC;AAErC,SAAS,SAAS,CAAC,CAAM;IACvB,OAAO,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC;AAC7C,CAAC;AACD,MAAM,MAAM,GAAG,IAAA,kBAAS,EAAC,UAAU,CAAC,CAAC;AAErC,SAAS,SAAS,CAChB,KAAW,EACX,GAAS,EACT,MAAc,EACd,MAAc;IAEd,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,KAAK,MAAM,KAAK,GAAG,CAAC,OAAO,EAAE,GAAG,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AAC7E,CAAC;AACD,SAAgB,QAAQ,CAAC,OAAO,GAAG,IAAI;IACrC,OAAO,CAAC,MAAW,EAAE,IAAY,EAAE,UAA8B,EAAQ,EAAE;QACzE,IAAI,OAAO,IAAI,CAAC,CAAC,UAAU,IAAI,OAAO,UAAU,CAAC,KAAK,KAAK,UAAU,EAAE;YACrE,MAAM,IAAI,GAAG,UAAU,CAAC,KAAK,CAAC;YAC9B,wDAAwD;YACxD,UAAU,CAAC,KAAK,GAAG,UAAU,GAAG,IAAW;gBACzC,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;gBACzB,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;gBACrC,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE;oBAClB,GAAG,CAAC,IAAI,CACN,CAAC,CAAM,EAAE,EAAE;wBACT,SAAS,CAAC,KAAK,EAAE,IAAI,IAAI,EAAE,EAAE,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;wBAC5D,OAAO,CAAC,CAAC;oBACX,CAAC,EACD,CAAC,GAAQ,EAAE,EAAE;wBACX,SAAS,CAAC,KAAK,EAAE,IAAI,IAAI,EAAE,EAAE,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;wBAC5D,MAAM,GAAG,CAAC;oBACZ,CAAC,CACF,CAAC;iBACH;qBAAM;oBACL,SAAS,CAAC,KAAK,EAAE,IAAI,IAAI,EAAE,EAAE,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;iBAC7D;gBACD,OAAO,GAAG,CAAC;YACb,CAAC,CAAC;SACH;IACH,CAAC,CAAC;AACJ,CAAC;AA1BD,4BA0BC;AAEM,MAAM,YAAY,GACvB,CAAC,MAAW,EAAE,MAAW,EAAE,IAAY,EAAO,EAAE,CAChD,CAAC,GAAG,IAAI,EAAE,EAAE;IACV,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;IACzB,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC;IAC5B,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE;QAClB,GAAG,CAAC,IAAI,CACN,CAAC,CAAM,EAAE,EAAE;YACT,SAAS,CAAC,KAAK,EAAE,IAAI,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;YAC3C,OAAO,CAAC,CAAC;QACX,CAAC,EACD,CAAC,GAAQ,EAAE,EAAE;YACX,SAAS,CAAC,KAAK,EAAE,IAAI,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;YAC3C,MAAM,GAAG,CAAC;QACZ,CAAC,CACF,CAAC;KACH;SAAM;QACL,SAAS,CAAC,KAAK,EAAE,IAAI,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;KAC5C;IACD,OAAO,GAAG,CAAC;AACb,CAAC,CAAC;AApBS,QAAA,YAAY,gBAoBrB","sourcesContent":["// Copyright 2020-2022 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n/* class decorator */\n\nimport { getLogger } from './logger';\n\nfunction isPromise(e: any): boolean {\n  return !!e && typeof e.then === 'function';\n}\nconst logger = getLogger('profiler');\n\nfunction printCost(\n  start: Date,\n  end: Date,\n  target: string,\n  method: string,\n): void {\n  logger.info(`${target}, ${method}, ${end.getTime() - start.getTime()} ms`);\n}\nexport function profiler(enabled = true): any {\n  return (target: any, name: string, descriptor: PropertyDescriptor): void => {\n    if (enabled && !!descriptor && typeof descriptor.value === 'function') {\n      const orig = descriptor.value;\n      // tslint:disable no-function-expression no-invalid-this\n      descriptor.value = function (...args: any[]): any {\n        const start = new Date();\n        const res = orig.bind(this)(...args);\n        if (isPromise(res)) {\n          res.then(\n            (_: any) => {\n              printCost(start, new Date(), target.constructor.name, name);\n              return _;\n            },\n            (err: any) => {\n              printCost(start, new Date(), target.constructor.name, name);\n              throw err;\n            },\n          );\n        } else {\n          printCost(start, new Date(), target.constructor.name, name);\n        }\n        return res;\n      };\n    }\n  };\n}\n\nexport const profilerWrap =\n  (method: any, target: any, name: string): any =>\n  (...args) => {\n    const start = new Date();\n    const res = method(...args);\n    if (isPromise(res)) {\n      res.then(\n        (_: any) => {\n          printCost(start, new Date(), target, name);\n          return _;\n        },\n        (err: any) => {\n          printCost(start, new Date(), target, name);\n          throw err;\n        },\n      );\n    } else {\n      printCost(start, new Date(), target, name);\n    }\n    return res;\n  };\n"]}